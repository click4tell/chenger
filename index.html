<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="خرید و فروش اندیکاتور سوپرترند، اکسپرت سوپرترند، اکسپرت فارکس فیوری، اکسپرت فیوری، اکسپرت سودآور، اکسپرت پرسود، برنامه متاتریدر، برنامه نویسی ام کیو ال 5، mq5، mq4، metatrader5، forex fury، super trend، forexfury، supertrend، ربات معاملاتی با سود عالی برای فارکس.">
    <meta name="keywords" content="اکسپرت, اندیکاتور, سوپرترند, اکسپرت سوپرترند, اکسپرت فارکس فیوری, اکسپرت فیوری, اکسپرت سودآور, اکسپرت پرسود, برنامه متاتریدر, برنامه نویسی ام کیو ال 5, mq5, mq4, metatrader5, forex fury, super trend, forexfury, supertrend, ربات معاملاتی">
    <title>فروش محصولات SuperTrend برای MT5</title>
    <link rel="icon" type="image/x-icon" href="/logo.ico">
    <style>
        /* تمام استایل‌های قبلی بدون تغییر */
        body{font-family:Arial,sans-serif;margin:0;padding:0;background:#FFF;color:#333;min-height:100vh;direction:ltr;text-align:left}
        .lang-switcher{position:fixed;top:10px;right:10px;z-index:1000;background:#4CAF50;color:white;border:none;padding:6px 8px;border-radius:10px;cursor:pointer;font-size:12px;max-width:52px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:4px;box-shadow:0 2px 8px rgba(0,0,0,0.25);transition:all .3s}
        .lang-switcher:hover{background:#45a049;transform:scale(1.08)}
        .lang-switcher img{width:26px;height:18px;border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,0.4)}
        .lang-switcher span{font-weight:bold;font-size:10px}
        header{position:relative;height:200px;overflow:hidden;text-align:center;padding-top:80px;color:#fff}
        #bgVideo{position:absolute;top:0;right:0;width:100%;height:100%;object-fit:cover;z-index:-1}
        header h1{font-size:1.8em;text-shadow:2px 2px 4px rgba(0,0,0,0.7);margin:0;color:#4CAF50;position:relative;z-index:1}
        header p{font-size:1.2em;text-shadow:1px 1px 3px rgba(0,0,0,0.7);color:#FFC107;margin:10px 15px;position:relative;z-index:1}
        .container{max-width:100%;margin:10px auto;padding:10px;background:#FFF;border-radius:10px;box-sizing:border-box;text-align:center}
        .product{background:#f9f9f9;padding:15px;margin:10px 15px;border-radius:8px;text-align:center;border:1px solid #ddd}
        form{margin:15px;padding:15px;background:#f9f9f9;border-radius:8px;border:1px solid #ddd;display:none;flex-direction:column;gap:10px}
        #paymentForm,#resetForm{display:none}
        input,select,button{padding:10px;margin:5px 0;width:100%;max-width:100%;box-sizing:border-box;border:1px solid #ccc;border-radius:5px;font-size:16px}
        button{background:#4CAF50;color:white;cursor:pointer;border:none;border-radius:5px}
        button:hover{background:#45a049}
        .container button{padding:10px 20px;font-size:16px;background:#0066cc;color:white;border:none;border-radius:5px}
        img{max-width:100%;height:auto;border-radius:5px;display:block;margin:10px auto}
        #result{margin:10px 15px;padding:10px;border:1px solid #ddd;border-radius:5px}
        h2,h3,p,a{text-align:center;margin:10px auto}
        h2{line-height:1.5}p{line-height:1.5}
        a{line-height:1.8;display:block;color:#0066cc;text-decoration:none}
        a:hover{text-decoration:underline}
        #copyText,#copyCardText{cursor:pointer;border:1px solid #ccc;padding:10px;margin:10px auto;border-radius:5px;width:fit-content}
        footer{background:#f9fafb;padding:15px 20px;text-align:center;border-top:1px solid #e5e7eb;box-shadow:0 -2px 4px rgba(0,0,0,0.1);font-size:14px;color:#374151;margin-top:20px}
        .download-button{display:inline-block;padding:10px 20px;margin:10px;background:#1d4ed8;color:white;text-decoration:none;border-radius:5px;font-size:14px;transition:.3s}
        .download-button:hover{background:#1e40af}
        .toast{position:fixed;top:20px;right:20px;min-width:250px;padding:12px 16px;border-radius:5px;color:white;font-weight:bold;z-index:1001;transform:translateX(300px);transition:.3s}
        .toast.show{transform:translateX(0)}
        .toast.success{background:#4CAF50}.toast.error{background:#f44336}.toast.loading{background:#FFC107}
        @media(min-width:768px){header{height:300px;padding-top:120px}header h1{font-size:2.5em}header p{font-size:3em}.container{max-width:750px;padding:20px}}
        @media(min-width:1024px){.container{max-width:1200px}header h1{font-size:2em}header p{font-size:2em}}
    </style>
</head>
<body>

    <button class="lang-switcher" onclick="toggleLanguage()">
        <img src="/ir.svg" alt="English" id="flag-gb">
        <img src="/gb.svg" alt="فارسی" id="flag-ir" style="display:none;">
        <span id="lang-text">فارسی</span>
    </button>

    <header>
        <video autoplay muted loop id="bgVideo">
            <source src="/logo.webm" type="video/webm">
            مرورگر شما از ویدیو پشتیبانی نمی‌کند.
        </video>
        <h1 data-fa="متاتریر 5 و ربات اتوماتیک معاملات فارکس و اندیکاتور" data-en="METATRADER 5 , MQL5 , MQ5 , EXPERT . INDICATOR">METATRADER 5 , MQL5 , MQ5 , EXPERT . INDICATOR</h1>
        <p data-fa="فروش محصولات اکسپرت واندیکاتور متاتریدر فارکس با سود عالی" data-en="Selling Expert and Indicator Products for MT5 Forex with High Profit">Selling Expert and Indicator Products for MT5 Forex with High Profit</p>
    </header>

    <div class="container">
        <h1 id="productsTitle" data-fa="محصولات ما" data-en="Our Products">Our Products</h1>
        <button onclick="window.open('/info.pdf', '_blank')" data-fa="info SUPERTREND" data-en="info SUPERTREND">info SUPERTREND</button>
        <button onclick="window.open('/ForexFuryPro.pdf', '_blank')" data-fa="info FOREXFURY" data-en="info FOREXFURY">info FOREXFURY</button>
        <button onclick="window.open('/ReportTester.pdf', '_blank')" data-fa="Riport FOREXFURY" data-en="Report FOREXFURY">Report FOREXFURY</button>
    </div>

    <div class="product" id="productContainer"></div>

    <div class="container">
        <button onclick="showPaymentForm()" data-fa="فرم دریافت اطلاعات برای پرداخت و خرید محصول" data-en="Payment and Purchase Form">Payment and Purchase Form</button>
    </div>

    <form id="paymentForm">
        <div id="trxDetails">
            <h3 data-fa="کادر زیر آدرس ترون ما جهت خرید شماست کلیک کنید آدرس کپی میشود" data-en="Click below to copy our Tron address for purchase">Click below to copy our Tron address for purchase</h3>
            <p id="copyText" onclick="copyToClipboard()" data-fa="TLBTbV3cjeR7GJU7321Q42Bjft4ZUDzVca" data-en="TLBTbV3cjeR7GJU7321Q42Bjft4ZUDzVca">TLBTbV3cjeR7GJU7321Q42Bjft4ZUDzVca</p>
            <label data-fa="هش تراکنش (txHash) را که پس از انتقال ارز گرفتید اینجا جاگذاری کنید:" data-en="Enter txHash after transfer:">Enter txHash after transfer:</label>
            <input type="text" name="txHashTrx" id="txHashTrx"><br>
            <label data-fa="مبلغ به تتر:" data-en="Amount in USDT:">Amount in USDT:</label>
            <input type="number" name="amountTeter" id="amountTeter" readonly><br>
        </div>

        <div id="cardCopySection">
            <h3 data-fa="کادر زیر شماره کارت ما جهت خرید شماست کلیک کنید شماره کپی میشود" data-en="Click below to copy our Bank Card number for purchase">Click below to copy our Bank Card number for purchase</h3>
            <p id="copyCardText" onclick="copyCardToClipboard()" data-fa="6219861903732864" data-en="6219861903732864">6219861903732864</p>
            <label data-fa="کد پیگیری یا شماره کارت یا شناسه پرداخت که از طریق آن واریزی داشتید وارد کنید" data-en="Enter cart number after transfer:">Enter the card number or transaction ID used for payment</label>
            <input type="text" name="txHashCard" id="txHashCard"><br>
        </div>

        <div id="cardDetails">
            <label data-fa="مبلغ به ریال:" data-en="Amount in IRR:">Amount in IRR:</label>
            <input type="number" name="amountRial" id="amountRial" readonly><br>
        </div>

        <label data-fa="روش پرداخت:" data-en="Payment Method:">Payment Method:</label>
        <div class="payment-method">
            <label><input type="radio" name="paymentMethod" value="trx" checked onchange="togglePaymentDetails()"> <span data-fa="ترون (TRX)" data-en="Tron (TRX)"></span></label>
            <label><input type="radio" name="paymentMethod" value="card" onchange="togglePaymentDetails()"> <span data-fa="کارت بانکی" data-en="Bank Card"></span></label>
        </div>

        <label data-fa="محصول:" data-en="Product:">Product:</label>
        <select name="product" id="productSelect" required onchange="updateAmounts()"></select><br>
        <label data-fa="شماره اکانت MT5:" data-en="MT5 Account Number:">MT5 Account Number:</label>
        <input type="number" name="account" required><br>
        <label data-fa="ایمیل:" data-en="Email:">Email:</label>
        <input type="email" name="email" required><br>
        <button type="submit" data-fa="پس از پرداخت و انتخاب محصول و وارد کردن شماره اکانت کلیک کنید" data-en="Submit After Payment">Submit After Payment</button>
        <div id="result"></div>
    </form>

    <!-- بقیه محتوا (تصاویر، ویدیوها، دانلودها و ...) بدون تغییر -->

    <script>
        let currentLang = localStorage.getItem('lang') || 'en';
        let WORKER_URL = currentLang === 'fa' ? 'https://supertrend-worker-fa.click4tell.workers.dev' : 'https://supertrend-worker-en.click4tell.workers.dev';
        let TETHER_PRICE_URL = 'https://tetercheng.click4tell.workers.dev/price';
        let tetherPriceInToman = 114000; // مقدار پیش‌فرض

        let products = {};
        let cardDetails = {};

        // دریافت قیمت لحظه‌ای تتر به تومان
        async function updateTetherPrice() {
            try {
                const res = await fetch(TETHER_PRICE_URL + '?' + Date.now());
                if (!res.ok) throw new Error('Worker error');
                const data = await res.json();
                tetherPriceInToman = data.tether_price_toman || 114000;
            } catch (err) {
                console.warn('خطا در دریافت قیمت تتر، از مقدار پیش‌فرض استفاده شد');
            }
        }

        async function fetchProductsAndCard() {
            await updateTetherPrice(); // اول قیمت تتر را به‌روز کن

            try {
                const response = await fetch(`${WORKER_URL}/products?lang=${currentLang}`);
                const rawProducts = await response.json();

                // تبدیل قیمت به ریال بر اساس قیمت لحظه‌ای تتر
                products = {};
                Object.keys(rawProducts).forEach(key => {
                    const p = rawProducts[key];
                    const rialPrice = Math.round(p.trx * tetherPriceInToman);
                    products[key] = {
                        ...p,
                        rial: rialPrice
                    };
                });

                const cardResponse = await fetch(`${WORKER_URL}/card-details?lang=${currentLang}`);
                cardDetails = await cardResponse.json();

                populateProducts();
                populateProductSelect();
                updateCardDisplay();
            } catch (error) {
                console.error('Error:', error);
                // مقادیر پیش‌فرض
                products = {
                    'EA&EM-SuperTrend&Footprint': { name_fa: 'اکسپرت EA&EM-SuperTrend&Footprint', name_en: 'EA&EM-SuperTrend&Footprint', trx: 15, rial: Math.round(15 * tetherPriceInToman) },
                    'EA_SuperTrend': { name_fa: 'اکسپرت SuperTrend EA', name_en: 'SuperTrend EA Expert', trx: 200, rial: Math.round(200 * tetherPriceInToman) },
                    'EA_ForexFury': { name_fa: 'اکسپرت ForexFury EA', name_en: 'ForexFury EA Expert', trx: 500, rial: Math.round(500 * tetherPriceInToman) }
                };
                cardDetails = { number: '6219861903732864', name: 'Kamran Mankarsi', bank: 'Saman Bank' };
                populateProducts();
                populateProductSelect();
                updateCardDisplay();
            }
        }

        function populateProducts() {
            const container = document.getElementById('productContainer');
            container.innerHTML = '';
            Object.keys(products).forEach(key => {
                const prod = products[key];
                const div = document.createElement('div');
                div.innerHTML = `
                    <h3 data-fa="${prod.name_fa || ''}" data-en="${prod.name_en || ''}">${currentLang === 'fa' ? (prod.name_fa || prod.name_en) : (prod.name_en || prod.name_fa)}</h3>
                    <p data-fa="${prod.desc_fa || ''}" data-en="${prod.desc_en || ''}">${currentLang === 'fa' ? (prod.desc_fa || prod.desc_en) : (prod.desc_en || prod.desc_fa)}</p>
                    <p data-fa="قیمت: ${prod.trx} TRX (شبکه TRC20) | معادل ${prod.rial.toLocaleString('fa-IR')} ریال" data-en="Price: ${prod.trx} TRX (TRC20) | ≈ ${prod.rial.toLocaleString('en-US')} IRR">
                        ${currentLang === 'fa' 
                            ? `قیمت: ${prod.trx} TRX (شبکه TRC20) | معادل ${prod.rial.toLocaleString('fa-IR')} ریال`
                            : `Price: ${prod.trx} TRX (TRC20) | ≈ ${prod.rial.toLocaleString('en-US')} IRR`}
                    </p>
                `;
                container.appendChild(div);
            });
            updateLanguage(currentLang);
        }

        function populateProductSelect() {
            const select = document.getElementById('productSelect');
            const currentValue = select.value;
            select.innerHTML = '';
            Object.keys(products).forEach(key => {
                const prod = products[key];
                const option = document.createElement('option');
                option.value = key;
                option.textContent = currentLang === 'fa' ? (prod.name_fa || prod.name_en) : (prod.name_en || prod.name_fa);
                select.appendChild(option);
            });
            select.value = currentValue || Object.keys(products)[0] || '';
            updateAmounts();
        }

        function updateAmounts() {
            const select = document.getElementById('productSelect');
            const key = select.value;
            if (key && products[key]) {
                document.getElementById('amountTeter').value = products[key].trx;
                document.getElementById('amountRial').value = products[key].rial;
            }
        }

        function updateCardDisplay() {
            const el = document.getElementById('copyCardText');
            if (el && cardDetails.number) {
                el.textContent = cardDetails.number;
            }
        }

        function togglePaymentDetails() {
            const method = document.querySelector('input[name="paymentMethod"]:checked').value;
            document.getElementById('trxDetails').style.display = method === 'trx' ? 'block' : 'none';
            document.getElementById('cardCopySection').style.display = method === 'card' ? 'block' : 'none';
            document.getElementById('cardDetails').style.display = method === 'card' ? 'block' : 'none';
        }

        function showPaymentForm() {
            document.getElementById('paymentForm').style.display = 'block';
            document.getElementById('paymentForm').scrollIntoView({ behavior: 'smooth' });
            togglePaymentDetails();
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(document.getElementById('copyText').innerText).then(() => alert(currentLang === 'fa' ? 'آدرس کپی شد!' : 'Address copied!'));
        }

        function copyCardToClipboard() {
            navigator.clipboard.writeText(document.getElementById('copyCardText').innerText).then(() => alert(currentLang === 'fa' ? 'شماره کارت کپی شد!' : 'Card copied!'));
        }

        function updateLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
            document.body.style.direction = lang === 'fa' ? 'rtl' : 'ltr';
            document.body.style.textAlign = lang === 'fa' ? 'right' : 'left';

            WORKER_URL = lang === 'fa' ? 'https://supertrend-worker-fa.click4tell.workers.dev' : 'https://supertrend-worker-en.click4tell.workers.dev';

            document.querySelectorAll('[data-fa]').forEach(el => {
                el.textContent = el.getAttribute(`data-${lang}`);
            });

            document.getElementById('flag-gb').style.display = lang === 'en' ? 'block' : 'none';
            document.getElementById('flag-ir').style.display = lang === 'fa' ? 'block' : 'none';
            document.getElementById('lang-text').textContent = lang === 'en' ? 'فارسی' : 'English';

            localStorage.setItem('lang', lang);
            fetchProductsAndCard();
        }

        function toggleLanguage() {
            updateLanguage(currentLang === 'en' ? 'fa' : 'en');
        }

        // به‌روزرسانی قیمت تتر هر 30 ثانیه
        setInterval(updateTetherPrice, 30000);

        document.getElementById('paymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const method = formData.get('paymentMethod');
            const endpoint = method === 'card' ? '/card-process' : '/process';
            try {
                const response = await fetch(`${WORKER_URL}${endpoint}`, { method: 'POST', body: formData });
                const result = await response.text();
                document.getElementById('result').innerHTML = result;
            } catch (error) {
                document.getElementById('result').innerHTML = currentLang === 'fa' ? 'خطا: ' + error.message : 'Error: ' + error.message;
            }
        });

        // بارگذاری اولیه
        window.addEventListener('load', () => {
            updateLanguage(currentLang);
        });
    </script>
</body>
</html>
